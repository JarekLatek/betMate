# Status implementacji widoku Mecze (Matches View)

## Status: ZAKOŃCZONY

Data zakończenia: 2025-12-08

---

## Podsumowanie

Widok "Mecze" stanowi ekran główny aplikacji (`/`). Umożliwia użytkownikom przeglądanie listy meczów w ramach wybranych turniejów oraz obstawianie ich wyników.

## Zaimplementowane funkcjonalności

### Podstawowe funkcje
- [x] Wybór turnieju z listy dropdown
- [x] Filtrowanie meczów (Nadchodzące / Zakończone)
- [x] Wyświetlanie listy meczów w formie kart
- [x] Obstawianie wyników (1/X/2)
- [x] Blokada obstawiania 5 minut przed meczem
- [x] Wyświetlanie wyników zakończonych meczów
- [x] Paginacja (przycisk "Załaduj więcej")
- [x] Toast notifications dla akcji użytkownika

### Obsługa stanów
- [x] Stan ładowania (spinner)
- [x] Stan błędu z przyciskiem "Spróbuj ponownie"
- [x] Stan pustej listy
- [x] Optimistic UI dla obstawiania

### Obsługa statusów meczów
- [x] SCHEDULED - możliwość obstawiania
- [x] IN_PLAY - zablokowane obstawianie
- [x] FINISHED - wyświetlanie wyniku i statusu zakładu
- [x] POSTPONED - komunikat "Mecz przełożony"
- [x] CANCELED - komunikat "Mecz odwołany"

---

## Struktura plików

### Komponenty React
| Plik | Opis |
|------|------|
| `src/components/matches/MatchesView.tsx` | Główny kontener widoku |
| `src/components/matches/TournamentSelector.tsx` | Dropdown wyboru turnieju |
| `src/components/matches/MatchListFilters.tsx` | Filtry Nadchodzące/Zakończone |
| `src/components/matches/MatchCard.tsx` | Karta pojedynczego meczu |
| `src/components/matches/BettingControls.tsx` | Przyciski obstawiania 1/X/2 |
| `src/components/matches/MatchResult.tsx` | Wyświetlanie wyniku meczu |

### Hooki
| Plik | Opis |
|------|------|
| `src/components/hooks/useMatches.ts` | Pobieranie meczów z paginacją |
| `src/components/hooks/useBetting.ts` | Logika obstawiania z optimistic UI |

### API Client
| Plik | Opis |
|------|------|
| `src/lib/api/matches.api.ts` | Frontend fetch wrappers |

### Komponenty UI (Shadcn)
| Plik | Opis |
|------|------|
| `src/components/ui/select.tsx` | Komponent Select |
| `src/components/ui/tabs.tsx` | Komponent Tabs |
| `src/components/ui/sonner.tsx` | Toast notifications |

### Strona Astro
| Plik | Opis |
|------|------|
| `src/pages/index.astro` | Strona główna z integracją MatchesView |

---

## Integracja API

### Wykorzystywane endpointy
- `GET /api/tournaments` - lista turniejów
- `GET /api/matches` - lista meczów z filtrowaniem
- `POST /api/bets` - tworzenie nowego zakładu
- `PUT /api/bets/:id` - aktualizacja zakładu

### Parametry GET /api/matches
- `tournament_id` - ID turnieju
- `status` - SCHEDULED lub FINISHED
- `limit` - liczba wyników (domyślnie 20)
- `offset` - offset paginacji

---

## Znane ograniczenia

### Schemat bazy danych
- Baza danych przechowuje tylko typ wyniku (`result`: HOME_WIN/DRAW/AWAY_WIN), nie dokładny wynik liczbowy (np. 2:1)
- Komponent MatchResult został dostosowany do wyświetlania typu wyniku zamiast liczbowego

### Do rozważenia w przyszłości
- [ ] Infinite scroll zamiast przycisku "Załaduj więcej"
- [ ] Automatyczne odświeżanie listy meczów
- [ ] Countdown do zamknięcia obstawiania
- [ ] Wynik liczbowy meczu (wymaga zmiany schematu DB)

---

## Testy

### Manualnie przetestowane scenariusze
- [ ] Wybór turnieju
- [ ] Przełączanie filtrów
- [ ] Obstawianie meczu
- [ ] Zmiana obstawionego wyniku
- [ ] Blokada obstawiania przed meczem
- [ ] Wyświetlanie wyników zakończonych meczów
- [ ] Obsługa błędów API
- [ ] Paginacja

---

## Weryfikacja techniczna

- [x] TypeScript: Brak błędów (`npx tsc --noEmit`)
- [x] ESLint: Brak błędów (`npm run lint`)
- [x] Build: Sukces (`npm run build`)
